aW1wb3J0IG9zCmltcG9ydCBqc29uCmZyb20gcHByaW50IGltcG9ydCBwcHJpbnQKaW1wb3J0IHNo
dXRpbAoKY2xhc3MgQXBwRXJyb3IoRXhjZXB0aW9uKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCB2
YWx1ZSk6CiAgICAgICAgc2VsZi52YWx1ZSA9IHZhbHVlCiAgICBkZWYgX19zdHJfXyhzZWxmKToK
ICAgICAgICByZXR1cm4gcmVwcihzZWxmLnZhbHVlKQoKY2xhc3MgQXBwbGljYXRpb246CiAgICBo
b21lID0gb3MuZ2V0ZW52KCJIT01FIikKICAgIGFwcERpciA9IG9zLmdldGVudigiSE9NRSIpICsg
Ii8uYWxpYXNtYWtlciIKICAgIGFsaWFzRmlsZSA9ICJhbGlhc2VzLnNoIgogICAgYWxpYXNKU09O
ID0gImFsaWFzLmpzb24iCiAgICBiYWNrdXAgPSAiYWxpYXMuanNvbi5iYWNrIgogICAgcmF3RGF0
YSA9ICIiInsKICAgICJzaGVsbCI6ICJ6c2hyYyIsCiAgICAiYWxpYXNlcyI6IHsKICAgICAgICAi
bHMiOiAibHMiLAogICAgICAgICJjbGVhciI6ICJjbGVhciIKICAgIH0KfQoiIiIKCiAgICBkZWYg
X19ib290X18oc2VsZik6CiAgICAgICAgc2VsZi5fX2lzQXBwRGlyVGhlcmUoKS5fX2ZpbmRBbmRD
cmVhdGVKU09OKCkuX19iYWNrVXAoKQoKICAgICAgICAjZmlsZU9wcwogICAgICAgIGZpbGVQYXRo
ID0gc2VsZi5hcHBEaXIgKyAiLyIgKyBzZWxmLmFsaWFzSlNPTgogICAgICAgIAogICAgICAgIGZp
bGVPcHMgPSBGaWxlT3BlcmF0aW9ucygpCiAgICAgICAgZmlsZU9wcy5FZGl0RmlsZShmaWxlUGF0
aCkKICAgICAgICBleHBvcnRzID0gZmlsZU9wcy5wYXJzZUpzb24oZmlsZVBhdGgpCiAgICAgICAg
c2VsZi53cml0ZVNoRmlsZShleHBvcnRzWzFdKS5saW5rU2goZXhwb3J0c1swXSkKIAogICAgZGVm
IF9faXNBcHBEaXJUaGVyZShzZWxmKToKICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhzZWxmLmFw
cERpcik6CiAgICAgICAgICAgIHByaW50KCJGb3VuZCBBcHBsaWNhdGlvbi4uIikKICAgICAgICBl
bHNlOgogICAgICAgICAgICBwcmludCgiQ3JlYXRpbmcgRGlyLi4uLiIpCiAgICAgICAgICAgIG9z
Lm1ha2VkaXJzKHNlbGYuYXBwRGlyKQogICAgICAgIHJldHVybiBzZWxmICAgICAgICAgICAKCiAg
ICBkZWYgX19maW5kQW5kQ3JlYXRlSlNPTihzZWxmKToKICAgICAgICBqc29uRmlsZSA9IHNlbGYu
YXBwRGlyICsgIi8iICsgc2VsZi5hbGlhc0pTT04KCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMo
anNvbkZpbGUpOgogICAgICAgICAgICBwcmludCgiU291cmNlIEZpbGUgRm91bmQuLi4iKQogICAg
ICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50KCJjcmVhdGluZyBtZXRhIHNvdXJjZSBmaWxlLi4u
IikKICAgICAgICAgICAgb2JqID0gb3Blbihqc29uRmlsZSwgInciKQogICAgICAgICAgICBvYmou
d3JpdGUoc2VsZi5yYXdEYXRhKQogICAgICAgICAgICBvYmouY2xvc2UoKQogICAgICAgIHJldHVy
biBzZWxmCgogICAgZGVmIF9fYmFja1VwKHNlbGYpOgogICAgICAgIHNyY2ZpbGUgPSBzZWxmLmFw
cERpciArICIvIiArIHNlbGYuYWxpYXNKU09OCiAgICAgICAgYmFja3VwZmlsZSA9IHNlbGYuYXBw
RGlyICsgIi8iICsgc2VsZi5iYWNrdXAKICAgICAgICBzaHV0aWwuY29weShzcmNmaWxlLCBiYWNr
dXBmaWxlKQoKICAgIGRlZiB3cml0ZVNoRmlsZShzZWxmLCBleHBvcnRzKToKICAgICAgICBzZXBl
cmF0b3IgPSAiXG4iCiAgICAgICAgc2hEYXRhID0gc2VwZXJhdG9yLmpvaW4oZXhwb3J0cykKICAg
ICAgICBzaCA9IHNlbGYuYXBwRGlyICsgIi8iICsgc2VsZi5hbGlhc0ZpbGUKICAgICAgICBwcmlu
dCgiY3JlYXRpbmcgc2ggZmlsZS4uLiIpCiAgICAgICAgc2ggPSBvcGVuKHNoLCAidyIpCiAgICAg
ICAgc2gud3JpdGUoc2hEYXRhKQogICAgICAgIHNoLmNsb3NlKCkKICAgICAgICByZXR1cm4gc2Vs
ZgoKICAgIGRlZiBsaW5rU2goc2VsZiwgc2hlbGxGaWxlKToKICAgICAgICAKICAgICAgICBjb21t
YW5kTGluayA9ICJcbnNvdXJjZSBcIiIgKyBzZWxmLmFwcERpciArICIvIiArIHNlbGYuYWxpYXNG
aWxlICsgIlwiIgogICAgICAgIGlmIG5vdCBjb21tYW5kTGluayBpbiBvcGVuKHNlbGYuaG9tZSAr
ICIvLiIgKyBzaGVsbEZpbGUsICJyIikucmVhZCgpOgogICAgICAgICAgICBwcmludCgibGlua2lu
ZyB3aXRoIFNoZWxsIEZpbGUiKQogICAgICAgICAgICBzaCA9IHNlbGYuaG9tZSArICIvLiIgKyBz
aGVsbEZpbGUKICAgICAgICAgICAgc2ggPSBvcGVuKHNoLCAiYSsiKQogICAgICAgICAgICBzaC53
cml0ZShjb21tYW5kTGluaykKICAgICAgICAgICAgc2guY2xvc2UoKQogICAgICAgIGVsc2U6CiAg
ICAgICAgICAgIHByaW50KCJsaW5rIEV4aXN0cyIpCgpjbGFzcyBGaWxlT3BlcmF0aW9uczoKICAg
IGVkaXRvcnMgPSBbImdlZGl0IiwgInZpIiwgImVtYWNzIl0KCiAgICBkZWYgRWRpdEZpbGUoc2Vs
ZiwgZmlsZVBhdGgpOgogICAgICAgIHByaW50KCIqKioqKioqKioqKioqKioqXG4gICAgRWRpdG8g
WW91ciBBbGlhcyBGaWxlIFxuKioqKioqKioqKioqKioqXG4iKQogICAgICAgIHRyeToKICAgICAg
ICAgICAgb3B0aW9uID0gcmF3X2lucHV0KCJzZWxlY3QgeW91ciBlZGl0b3IgKDEuIGdlZGl0LCAy
LiB2aW0sIDMuZW1hY3MgNC4gb3RoZXIgLi4uIGVudGVyIHRvIHNraXApID8gIikKICAgICAgICBl
eGNlcHQ6CiAgICAgICAgICAgIG9wdGlvbiA9IGlucHV0KCJzZWxlY3QgeW91ciBlZGl0b3IgKDEu
IGdlZGl0LCAyLiB2aW0sIDMuZW1hY3MgNC4gb3RoZXIgLi4uIGVudGVyIHRvIHNraXApID8gIikK
ICAgICAgICBlZGl0b3IgPSAiIgogICAgICAgIGlmIG9wdGlvbiBpcyAiIjoKICAgICAgICAgICAg
ZWRpdG9yID0gImNhdCIKICAgICAgICBlbGlmIGludChvcHRpb24pIDwgNDoKICAgICAgICAgICAg
ZWRpdG9yID0gc2VsZi5lZGl0b3JzW2ludChvcHRpb24pLTFdCiAgICAgICAgZWxzZToKICAgICAg
ICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZWRpdG9yID0gc3RyKHJhd19pbnB1dCgiZW50ZXIg
eW91ciBlZGl0b3I6ICIpKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBlZGl0
b3IgPSBzdHIoaW5wdXQoImVudGVyIHlvdXIgZWRpdG9yOiAiKSkKCiAgICAgICAgY29tbWFuZCA9
IGVkaXRvciArICIgIiArZmlsZVBhdGgKICAgICAgICByZXR1cm4gb3Muc3lzdGVtKGNvbW1hbmQp
CgogICAgZGVmIHBhcnNlSnNvbihzZWxmLCBmaWxlUGF0aCk6CiAgICAgICAganNvbkZpbGU9b3Bl
bihmaWxlUGF0aCkKICAgICAgICBkYXRhID0ganNvbi5sb2FkKGpzb25GaWxlKQogICAgICAgIGpz
b25GaWxlLmNsb3NlKCkKCiAgICAgICAgZXhwb3J0cyA9IFtdCiAgICAgICAgYWxpYXNlcyA9IGRh
dGFbJ2FsaWFzZXMnXQogICAgICAgIHNoZWxsID0gZGF0YVsnc2hlbGwnXQogICAgICAgIGtleXMg
PSBhbGlhc2VzLmtleXMoKQogICAgICAgIGZvciBrZXkgaW4ga2V5czoKICAgICAgICAgICAgZXhw
b3J0cy5hcHBlbmQoImFsaWFzICIgKyBrZXkgKyAiPSIgKyAiXCIiICsgYWxpYXNlc1trZXldICsi
XCIiKQoKICAgICAgICByZXR1cm4gW3NoZWxsLCBleHBvcnRzXQoKYXBwID0gQXBwbGljYXRpb24o
KQphcHAuX19ib290X18oKQo=
